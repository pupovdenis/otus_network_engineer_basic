## Лабораторная работа. Доступ к сетевым устройствам по протоколу SSH

### Лабораторная работа. Доступ к сетевым устройствам по протоколу SSH

### Топология

![img.png](images/img.png)

### Таблица адресации

|**Устройство**|**Интерфейс**|**IP-адрес**|**Маска подсети**|**Шлюз по умолчанию**|
| :-: | :-: | :-: | :-: | :-: |
|R1|G0/0/1|192\.168.1.1|255\.255.255.0|—|
|S1|VLAN 1|192\.168.1.11|255\.255.255.0|192\.168.1.1|
|PC-A|NIC|192\.168.1.3|255\.255.255.0|192\.168.1.1|

### Задачи

>#### Часть 1. Настройка основных параметров устройства

>#### Часть 2. Настройка маршрутизатора для доступа по протоколу SSH

>#### Часть 3. Настройка коммутатора для доступа по протоколу SSH

>#### Часть 4. SSH через интерфейс командной строки (CLI) коммутатора

### Общие сведения/сценарий
Раньше для удаленной настройки сетевых устройств в основном применялся протокол Telnet. Однако он не обеспечивает шифрование информации, передаваемой между клиентом и сервером, что позволяет анализаторам сетевых пакетов перехватывать пароли и данные конфигурации.

Secure Shell (SSH) — это сетевой протокол, устанавливающий безопасное подключение с эмуляцией терминала к маршрутизатору или иному сетевому устройству. Протокол SSH шифрует все сведения, которые поступают по сетевому каналу, и предусматривает аутентификацию удаленного компьютера. Протокол SSH все больше заменяет Telnet — именно его выбирают сетевые специалисты в качестве средства удаленного входа в систему. SSH чаще всего используется для входа на удаленное устройство и выполнения команд. Но это может также передавать файлы по связанным протоколам SFTP или SCP.

Чтобы протокол SSH мог работать, на сетевых устройствах, взаимодействующих между собой, должна быть настроена поддержка SSH. В этой лабораторной работе необходимо включить SSH-сервер на маршрутизаторе, после чего подключиться к этому маршрутизатору, используя ПК с установленным клиентом SSH. В локальной сети подключение обычно устанавливается с помощью Ethernet и IP.

**Примечание**: Маршрутизаторы, используемые в практических лабораторных работах CCNA, - это Cisco 4221 с Cisco IOS XE Release 16.9.4 (образ universalk9). В лабораторных работах используются коммутаторы Cisco Catalyst 2960 с Cisco IOS версии 15.2(2) (образ lanbasek9). Можно использовать другие маршрутизаторы, коммутаторы и версии Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах. Правильные идентификаторы интерфейса см. в сводной таблице по интерфейсам маршрутизаторов в конце лабораторной работы.

**Примечание**:  Убедитесь, что у всех маршрутизаторов и коммутаторов была удалена начальная конфигурация. Если вы не уверены, обратитесь к инструктору.

### Необходимые ресурсы
- 1 Маршрутизатор (Cisco 4221 с универсальным образом Cisco IOS XE версии 16.9.4 или аналогичным)
- 1 коммутатор (Cisco 2960 с ПО Cisco IOS версии 15.2(2) с образом lanbasek9 или аналогичная модель)
- 1 ПК (под управлением Windows с программой эмуляции терминала, например, Tera Term)
- Консольные кабели для настройки устройств Cisco IOS через консольные порты.
- Кабели Ethernet, расположенные в соответствии с топологией

### Инструкции

#### Часть 1. Настройка основных параметров устройств
В части 1 потребуется настроить топологию сети и основные параметры, такие как IP-адреса интерфейсов, доступ к устройствам и пароли на маршрутизаторе.
##### Шаг 1. Создайте сеть согласно топологии.
##### Шаг 2. Выполните инициализацию и перезагрузку маршрутизатора и коммутатора.
##### Шаг 3. Настройте маршрутизатор.
a. Подключитесь к маршрутизатору с помощью консоли и активируйте привилегированный режим EXEC.
b. Войдите в режим конфигурации.
c. Отключите поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
   
![img_1.png](images/img_1.png)

d. Назначьте **class** в качестве зашифрованного пароля привилегированного режима EXEC.

![img_2.png](images/img_2.png)

e. Назначьте **cisco** в качестве пароля консоли и включите вход в систему по паролю.

![img_3.png](images/img_3.png)

f. Назначьте **cisco** в качестве пароля VTY и включите вход в систему по паролю.

![img_4.png](images/img_4.png)

g. Зашифруйте открытые пароли.

![img_5.png](images/img_5.png)

h. Создайте баннер, который предупреждает о запрете несанкционированного доступа.

![img_6.png](images/img_6.png)

i. Настройте и активируйте на маршрутизаторе интерфейс G0/0/1, используя информацию, приведенную в таблице адресации.

![img_8.png](images/img_8.png)

j. Сохраните текущую конфигурацию в файл загрузочной конфигурации.

![img_7.png](images/img_7.png)

##### Шаг 4. Настройте компьютер PC-A.
a. Настройте для PC-A IP-адрес и маску подсети.

b. Настройте для PC-A шлюз по умолчанию.

![img_9.png](images/img_9.png)

##### Шаг 5. Проверьте подключение к сети.
Пошлите с PC-A команду Ping на маршрутизатор R1. Если эхо-запрос с помощью команды ping не проходит, найдите и устраните неполадки подключения.

![img_10.png](images/img_10.png)

##
#### Часть 2. Настройка маршрутизатора для доступа по протоколу SSH
Подключение к сетевым устройствам по протоколу Telnet сопряжено с риском для безопасности, поскольку вся информация передается в виде открытого текста. Протокол SSH шифрует данные сеанса и обеспечивает аутентификацию устройств, поэтому для удаленных подключений рекомендуется использовать именно этот протокол. В части 2 вам нужно настроить маршрутизатор для приема соединений SSH по линиям VTY.

##### Шаг 1. Настройте аутентификацию устройств.
При генерации ключа шифрования в качестве его части используются имя устройства и домен. Поэтому эти имена необходимо указать перед вводом команды **crypto key**.

a. Задайте имя устройства.

b. Задайте домен для устройства.

![img_11.png](images/img_11.png)

##### Шаг 2. Создайте ключ шифрования с указанием его длины.

![img_12.png](images/img_12.png)

##### Шаг 3. Создайте имя пользователя в локальной базе учетных записей.
Настройте имя пользователя, используя **admin** в качестве имени пользователя и **Adm1nP @55** в качестве пароля.

![img_13.png](images/img_13.png)

##### Шаг 4. Активируйте протокол SSH на линиях VTY.

a. Активируйте протоколы Telnet и SSH на входящих линиях VTY с помощью команды **transport input**.

![img_19.png](images/img_19.png)

b. Измените способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.

![img_16.png](images/img_16.png)

##### Шаг 5. Сохраните текущую конфигурацию в файл загрузочной конфигурации.

##### Шаг 6. Установите соединение с маршрутизатором по протоколу SSH.

a. Запустите Tera Term с PC-A.

b. Установите SSH-подключение к R1. Use the username **admin** and password **Adm1nP@55**. У вас должно получиться установить SSH-подключение к R1.

![img_17.png](images/img_17.png)

##
#### Часть 3. Настройка коммутатора для доступа по протоколу SSH

В части 3 вам предстоит настроить коммутатор для приема подключений по протоколу SSH, а затем установить SSH-подключение с помощью программы Tera Term.

##### Шаг 1. Настройте основные параметры коммутатора.
a. Подключитесь к коммутатору с помощью консольного подключения и активируйте привилегированный режим EXEC.

b. Войдите в режим конфигурации.

c. Отключите поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.

![img_18.png](images/img_18.png)

d. Назначьте **class** в качестве зашифрованного пароля привилегированного режима EXEC.

![img_20.png](images/img_20.png)

e. Назначьте **cisco** в качестве пароля консоли и включите вход в систему по паролю.

![img_21.png](images/img_21.png)

f. Назначьте **cisco** в качестве пароля VTY и включите вход в систему по паролю.

![img_22.png](images/img_22.png)

g. Зашифруйте открытые пароли.

![img_23.png](images/img_23.png)

h. Создайте баннер, который предупреждает о запрете несанкционированного доступа.

![img_24.png](images/img_24.png)

i. Настройте и активируйте на коммутаторе интерфейс VLAN 1, используя информацию, приведенную в таблице адресации.

![img_25.png](images/img_25.png)

j. Сохраните текущую конфигурацию в файл загрузочной конфигурации.

![img_26.png](images/img_26.png)

##### Шаг 2. Настройте коммутатор для соединения по протоколу SSH.
Для настройки протокола SSH на коммутаторе используйте те же команды, которые применялись для аналогичной настройки маршрутизатора в части 2.

a. Настройте имя устройства, как указано в таблице адресации.

b. Задайте домен для устройства.

![img_27.png](images/img_27.png)

c. Создайте ключ шифрования с указанием его длины.

![img_28.png](images/img_28.png)

![img_29.png](images/img_29.png)

d. Создайте имя пользователя в локальной базе учетных записей.

![img_30.png](images/img_30.png)

e. Активируйте протоколы Telnet и SSH на линиях VTY.

![img_31.png](images/img_31.png)

f. Измените способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.

![img_32.png](images/img_32.png)

##### Шаг 3. Установите соединение с коммутатором по протоколу SSH.
Запустите программу Tera Term на PC-A, затем установите подключение по протоколу SSH к интерфейсу SVI коммутатора S1.

    Вопрос: Удалось ли вам установить SSH-соединение с коммутатором?
    Ответ: Да

![img_14.png](images/img_14.png)

##
#### Часть 4. Настройка протокола SSH с использованием интерфейса командной строки (CLI) коммутатора**
Клиент SSH встроен в операционную систему Cisco IOS и может запускаться из интерфейса командной строки. В части 4 вам предстоит установить соединение с маршрутизатором по протоколу SSH, используя интерфейс командной строки коммутатора.

##### Шаг 1. Посмотрите доступные параметры для клиента SSH в Cisco IOS.

Используйте вопросительный знак (**?**), чтобы отобразить варианты параметров для команды **ssh**.

```
S1# ssh?
-c Select encryption algorithm
-l Log in using this user name
-m Select HMAC algorithm
-o Specify options
-p Connect to this port
-v Specify SSH Protocol Version
-vrf Specify vrf name
WORD IP-адрес или имя хоста удаленной системы
```

##### Шаг 2. Установите с коммутатора S1 соединение с маршрутизатором R1 по протоколу SSH.

a. Чтобы подключиться к маршрутизатору R1 по протоколу SSH, введите команду **–l admin**. Это позволит вам войти в систему под именем **admin**. При появлении приглашения введите в качестве пароля **Adm1nP@55**
```
S1# ssh -l admin 192.168.1.1
Password: 
Authorized Users Only!
R1>
```
![img_15.png](images/img_15.png)

b. Чтобы вернуться к коммутатору S1, не закрывая сеанс SSH с маршрутизатором R1, нажмите комбинацию клавиш **Ctrl**+**Shift**+**6**. Отпустите клавиши **Ctrl**+**Shift**+**6** и нажмите **x**. Отображается приглашение привилегированного режима EXEC коммутатора.
```
R1>
S1#
```
![img_33.png](images/img_33.png)

c. Чтобы вернуться к сеансу SSH на R1, нажмите клавишу Enter в пустой строке интерфейса командной строки. Чтобы увидеть окно командной строки маршрутизатора, нажмите клавишу Enter еще раз.
```
      S1#
      [Resuming connection 1 to 192.168.1.1 ... ]
      
      R1>
```
   1. Чтобы завершить сеанс SSH на маршрутизаторе R1, введите в командной строке маршрутизатора команду **exit**.
```
      R1# **exit**
      
      [Connection to 192.168.1.1 closed by foreign host]
      S1#
```
    Вопрос: Какие версии протокола SSH поддерживаются при использовании интерфейса командной строки?
    Ответ: 1 и 2

![img_34.png](images/img_34.png)

##### Вопрос для повторения

    Вопрос: Как предоставить доступ к сетевому устройству нескольким пользователям, у каждого из которых есть собственное имя пользователя?
    Ответ: За счет vty - каждый работает в своем виртуальном пространстве

#
#
##### Сводная таблица по интерфейсам маршрутизаторов

|**Модель маршрутизатора**|**Интерфейс Ethernet № 1**|**Интерфейс Ethernet №2**|**Последовательный интерфейс № 1**|**Последовательный интерфейс №2**|
| :-: | :-: | :-: | :-: | :-: |
|1800|Fast Ethernet 0/0 (F0/0)|Fast Ethernet 0/1 (F0/1)|Serial 0/0/0 (S0/0/0)|Serial 0/0/1 (S0/0/1)|
|1900|Gigabit Ethernet 0/0 (G0/0)|Gigabit Ethernet 0/1 (G0/1)|Serial 0/0/0 (S0/0/0)|Serial 0/0/1 (S0/0/1)|
|2801|Fast Ethernet 0/0 (F0/0)|Fast Ethernet 0/1 (F0/1)|Serial 0/1/0 (S0/1/0)|Serial 0/1/1 (S0/1/1)|
|2811|Fast Ethernet 0/0 (F0/0)|Fast Ethernet 0/1 (F0/1)|Serial 0/0/0 (S0/0/0)|Serial 0/0/1 (S0/0/1)|
|2900|Gigabit Ethernet 0/0 (G0/0)|Gigabit Ethernet 0/1 (G0/1)|Serial 0/0/0 (S0/0/0)|Serial 0/0/1 (S0/0/1)|
|4221|Gigabit Ethernet 0/0/0 (G0/0/0)|Gigabit Ethernet 0/0/1 (G0/0/1)|Serial 0/1/0 (S0/1/0)|Serial 0/1/1 (S0/1/1)|
|4300|Gigabit Ethernet 0/0/0 (G0/0/0)|Gigabit Ethernet 0/0/1 (G0/0/1)|Serial 0/1/0 (S0/1/0)|Serial 0/1/1 (S0/1/1)|

**Примечание**. Чтобы определить конфигурацию маршрутизатора, можно посмотреть на интерфейсы и установить тип маршрутизатора и количество его интерфейсов. Перечислить все комбинации конфигураций для каждого класса маршрутизаторов невозможно. Эта таблица содержит идентификаторы для возможных комбинаций интерфейсов Ethernet и последовательных интерфейсов на устройстве. Другие типы интерфейсов в таблице не представлены, хотя они могут присутствовать в данном конкретном маршрутизаторе. В качестве примера можно привести интерфейс ISDN BRI. Строка в скобках — это официальное сокращение, которое можно использовать в командах Cisco IOS для обозначения интерфейса.
